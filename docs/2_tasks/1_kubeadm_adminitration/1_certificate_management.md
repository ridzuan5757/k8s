# Certificate management with kubeadm

Client certificates generated by kubeadm expire after 1 year. This page explains
how to manage certificate renewals with kubeadm. It also covers other tasks
related to kubeadm certificate management.

## Check certificate expiration

We can use the `check-expiration` subcommand to check when certificates expire:

```bash
kubeadm certs check-expiration
```

The output is similar to this:

```bash
CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED
admin.conf                 Dec 30, 2020 23:36 UTC   364d                                    no
apiserver                  Dec 30, 2020 23:36 UTC   364d            ca                      no
apiserver-etcd-client      Dec 30, 2020 23:36 UTC   364d            etcd-ca                 no
apiserver-kubelet-client   Dec 30, 2020 23:36 UTC   364d            ca                      no
controller-manager.conf    Dec 30, 2020 23:36 UTC   364d                                    no
etcd-healthcheck-client    Dec 30, 2020 23:36 UTC   364d            etcd-ca                 no
etcd-peer                  Dec 30, 2020 23:36 UTC   364d            etcd-ca                 no
etcd-server                Dec 30, 2020 23:36 UTC   364d            etcd-ca                 no
front-proxy-client         Dec 30, 2020 23:36 UTC   364d            front-proxy-ca          no
scheduler.conf             Dec 30, 2020 23:36 UTC   364d                                    no

CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED
ca                      Dec 28, 2029 23:36 UTC   9y              no
etcd-ca                 Dec 28, 2029 23:36 UTC   9y              no
front-proxy-ca          Dec 28, 2029 23:36 UTC   9y              no
```

The command shows expiration / residual time for the client certificates in the
`/etc/kubernetes/pki` folder and for the client certificate embedded in the
kubeconfig files used by kubeadm:
- `admin.conf`
- `controller-manager.conf`
- `scheduler-confg`

Additionally, kubeadm informs the user if the certificate is externally managed;
in this case, the user should take care managing certificate renewal manually /
using other tools.

> :warning: `kubeadm` cannot manage certificates signed by external CA.

> :note: `kubelet.conf` is not included in the list above because kubeadm
> configures kubelet for automatic certificate renewal with rotatable
> certificates under `/var/lib/kubelet/pki`.

> :warning: On nodes creaated with `kubeadm init`, prior to kubeadm version
> 1.17, there is a bug where we manually have to modify contents of
> kubelet.conf. After `kubeadm init` finishes, we should update `kubelet.conf`
> to point to the rotated client certificates, by replacing
> `client-certificate-data` and `client-key data with`:
>
> ```bash
> client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem
> client-key: /var/lib/kubelet/pki/kubelet-client-current.pem
> ```

